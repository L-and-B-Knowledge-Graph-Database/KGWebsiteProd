{% load static %}
<!doctype html>

<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Donors Knowledge Graph</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Slab&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static "chosen/docsupport/style.css" %}">
    <link rel="stylesheet" href="{% static "chosen/docsupport/prism.css" %}">
    <link rel="stylesheet" href="{% static "chosen/chosen.css" %}">
    
    <script src="https://cdn.neo4jlabs.com/neovis.js/v1.5.0/neovis.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>

      .bodyWrapper {
        width: 100%;
        height: 100%;
        margin:0 auto 0 auto;
        padding:50px;
        border-style: solid;
        border-color: #FFCB05;
      }

      .graphWrapper {
        width: 100%;
        height: 100%;
        margin:0 auto 0 auto;
        padding:50px;
        border-style: solid;
        border-color: #FFCB05;
      }

      .graphWrapper .graphContainer{
        height: 812px;
        border-style: solid;
        border-color: #FFCB05;
        background-color:white;
        border-width: 2px;
      }
      div.side-by-side > div {
        padding:0%;
        width: 30%;
      }
    </style>
  </head>

  <body onload="loadInterests()" style="font-family: 'Roboto', sans-serif;">

    {% include 'navbar.html' %}

    <div class="bodyWrapper" id="main">
      <!-- searchbar -->
      <div class="input-group">
        <input id="cypherCommand" type="search" class="form-control rounded" placeholder="Enter Cypher Command" aria-label="Search" aria-describedby="search-addon" />
      </div>
      <!-- searchbar -->
      <h2><a name="optgroup-support" class="anchor" href="#optgroup-support" >Query Engine</a></h2>
      <div class="input-group mb-3" id="firstRow">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-default"  style="background-color: #00274C; color: white; border-color: #FFCB05; border-width:2px;">Donor IDs</span>
        </div>
        <input type="search" id="uniqueBar" class="form-control" aria-label="Default" placeholder="separate IDs with a comma" aria-describedby="inputGroup-sizing-sm" id="donor_ids">
      </div>
      <div class="side-by-side clearfix" style="width:50%">
        <div>
          <em>Donor Version</em>
          <select data-placeholder="Choose Donor Versions" class="chosen-select" multiple tabindex="6" style="width:85%;" id="donor_versions">
            <option value=""></option>
            <option>Annual</option>
            <option>Major</option>
          </select>
        </div>
        <div>
          <em>Click Count</em>
          <select  class="chosen-select" style="width:3rem;" id="click_compare">
            <option value=""></option>
            <option>></option>
            <option selected>=</option>
            <option><</option>
          </select>
          <input placeholder="Choose Click Count" style="font-size:small; height: 30px;" id="click_count"></input>
        </div>
        <div>
          <em>Interest Labels</em>
          <select data-placeholder="Choose Interest Labels" class="chosen-select" id="interests" multiple tabindex="6" style="padding:0;">
            <option value=""></option>
          </select>
        </div>
      </div>
      <button type="button" class="btn btn-outline-primary" onclick="draw(cypherCommand.value)" style="border-color: #00274C; color: #00274C;">Go!</button>
    </div>
    <hr style="height:2px;border-width:0;color:gray;background-color:gray">

    <div class="graphWrapper">
      <div class="graphContainer" id="viz"></div>
    </div>

    <script src= "{% static "chosen/docsupport/jquery-3.2.1.min.js" %}" type="text/javascript"></script>
    <script src="{% static "chosen/chosen.jquery.js" %}" type="text/javascript"></script>
    <script src= "{% static "chosen/docsupport/prism.js" %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static "chosen/docsupport/init.js" %}" type="text/javascript" charset="utf-8"></script>
  </body>

  
  <script>

    async function get_query_inputs() {
      var donor_ids = document.getElementById("uniqueBar");
      var donor_versions = document.getElementById("donor_versions");
      var click_compare = document.getElementById("click_compare");
      var click_count = document.getElementById("click_count");
      var interests = document.getElementById("interests");
      console.log(donor_ids.value)
      console.log(donor_versions)
      console.log(click_compare.value)
      console.log(click_count.value)
      console.log(interests.value)
    }

    async function loadInterests() {

      var host = document.getElementById("interests");

      await $.getJSON( "/interests/", function( data ) {
        $.each(data, function(key, val){
          var group = document.createElement("optgroup");
          var category = key;
          group.setAttribute("label", category);
          for (var i = 0; i < data[key].length; ++i) {
            var thisOption = document.createElement("option");
            thisOption.append(data[key][i])
            group.append(thisOption)
          }
          host.append(group)
        });
      });

      $("#interests").trigger("chosen:updated");
    }

    function get_cypher_result(command) {
      fetch("[host]/cypher/" + command + "/", {method:"GET"}) 
      .then((data)=>{ 
      console.log(data.text) ;
    })
    }

    function tester() {
      var input = document.createElement("input");
      var host = document.getElementById("main");
      host.appendChild(input)
    }

    function draw(myCommand) {

      var config = {
        container_id: "viz",
        server_url: "neo4j://45fbc634.databases.neo4j.io",
        server_user: "neo4j",
        server_password: "BcW9ECss4d1xqgpUErbSAr32D5chvZTr9onX3JOxaR0",
        labels: {
            "Interest": {
              caption: "Name"
            },
            "Donor": {
              caption: "abr"
            }
        },
        relationships: {
            "CLICKED": {
              caption: "count",
              thickness: "count"
            }
        },
        initial_cypher: myCommand
      }

      var viz = new NeoVis.default(config);
      viz.render();
    }
  </script>

</html>